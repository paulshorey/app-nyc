<html>

<head>
    <style>
        .btn-confirm {
            display: block;
            margin: 10px auto;
            background-color: #009CDE;
            font-weight: bold;
            height: 35px;
            width: 90px;
        }

        .btn { 
            color: #ffffff;
            font-weight: normal;
            box-shadow: none !important;
            outline: none;
            line-height: 100%;
            border: 0;
            cursor: pointer;
            border-radius: 4px;
            font-size: 13px;
        }

        btn:hover, btn:focus, btn:active  {
            color:#fff;
            outline: 0 !important;
        }
    </style>
</head>
<body>
  <form id="braintree-form">
    <div id="braintree-dropin"></div>
    <input type="submit" class="btn btn-confirm" value="Submit">
  </form>
  <!-- braintree scripts -->
  <script type="text/javascript" src="https://js.braintreegateway.com/v2/braintree.js"></script>
  <script src="https://js.braintreegateway.com/v1/braintree-data.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script type="text/javascript">
      var userId;

      var checkBTload = setInterval(function() {
        if (window.parent.BTload) {
          BTload = window.parent.BTload();
          clearInterval(checkBTload);

            window.BraintreeData.setup(BTload.merchantId, 'braintree-form', window.BraintreeData.environments[BTload.env]);

            $.ajax({
                url: BTload.base + "/php/api/store/purchaseToken",
                type: 'post',
                data: {
                    userId: BTload.id,
                    s: BTload.session
                },
                headers: {
                    "X-Requested-By": BTload.requestBy,
                    "Content-type": "application/x-www-form-urlencoded"
                },
                dataType: 'json',
                success: function(data) {
                    if (data.errorCode === 0) {
                        window.braintree.setup(
                            data.token,
                            'dropin', {
                                container: 'braintree-dropin',
                                paymentMethodNonceReceived: function(event, nonce) {
                                var activeItem = window.parent.BTitem();
                                $.ajax({
                                    url: BTload.base + '/php/api/store/buy',
                                    type: 'post',
                                    data: {
                                        data: activeItem.price,
                                        signature: nonce,
                                        sku: activeItem.SKU,
                                        userId: BTload.id,
                                        device_data: document.getElementById('device_data').value,
                                        s: BTload.session
                                    },
                                    headers: {
                                        "X-Requested-By": BTload.requestBy,
                                        "Content-type": "application/x-www-form-urlencoded"
                                    },
                                    dataType: 'json',
                                    success: function(data) {
                                        window.parent.BTdone(data);
                                    }
                                });
                            }
                        });
                    }
                }
            });
        }
      }, 500);
  </script>
</body>
</html>